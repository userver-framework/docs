<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
  <html xmlns="http://www.w3.org/1999/xhtml">
    <head>
      <!-- Yandex.Metrika counter -->
      <script type="text/javascript" >
        (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();
        for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
        k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
        (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");
        ym(94541714, "init", {
            clickmap:true,
            trackLinks:true,
            accurateTrackBounce:true,
            webvisor:true
        });
      </script>
      <noscript><div><img src="https://mc.yandex.ru/watch/94541714" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
      <!-- /Yandex.Metrika counter -->
      <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
      <meta http-equiv="X-UA-Compatible" content="IE=9"/>
      <meta name="generator" content="Doxygen 1.9.8"/>
      <meta name="viewport" content="width=device-width, initial-scale=1"/>
      <meta property="og:image" content="../../logo_in_circle.png"/>
      <meta property="og:image:alt" content="userver logo"/>
      <link rel="icon" href="../../favicon.svg">
      <title>userver: Configure and Build</title>
      <!-- Roboto fonts -->
      <link rel="preconnect" href="https://fonts.googleapis.com">
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,500;0,700;1,400;1,500;1,700&display=swap" rel="stylesheet">
      <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:ital@0;1&family=Roboto:ital,wght@0,400;0,500;0,700;1,400;1,500;1,700&display=swap" rel="stylesheet">
      <!-- Roboto fonts -->
      <link href="../../tabs.css" rel="stylesheet" type="text/css"/>
      <script type="text/javascript" src="../../jquery.js"></script>
      <!-- Highlight.js -->
      <link rel="stylesheet" href="../../highlightjs.css">
      <script src="../../highlight.min.js"></script>
      <!-- Highlight.js -->
      <!-- Roboto fonts -->
      <script type="text/javascript" src="../../dynsections.js"></script>
      <link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
      <link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
      <link href="../../doxygen.css" rel="stylesheet" type="text/css" />
      <link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
      <link rel="stylesheet" href="../../customdoxygen.css">
      <!-- Doxygen Awesome -->
      <script type="text/javascript" src="../../doxygen-awesome-darkmode-toggle.js"></script>
      <script type="text/javascript" src="../../doxygen-awesome-fragment-copy-button.js"></script>
      <script type="text/javascript" src="../../doxygen-awesome-paragraph-link.js"></script>
      <script type="text/javascript" src="../../doxygen-awesome-interactive-toc.js"></script>
      <script type="text/javascript" src="../../toc.js"></script>
      <script type="text/javascript">
        DoxygenAwesomeDarkModeToggle.init()
        DoxygenAwesomeFragmentCopyButton.init()
        DoxygenAwesomeParagraphLink.init()
        DoxygenAwesomeInteractiveToc.init()
      </script>
      <!-- Doxygen Awesome -->
    </head>
    <body>
      <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
        <div id="titlearea">
          <table cellspacing="0" cellpadding="0" style="width: 100%;">
            <tbody>
              <tr style="height: 56px;">
                <td id="projectlogo"><a id='logo-anchor' href="../../index.html"><img alt="Logo" src="../../logo.svg"/></a></td>
                <td id="projectalign">
                  <div id="projectname">
                    <a class="titlelink" href="../../index.html">userver
                    </a>
                  </div>
                  <div id="projectbrief"><a class="titlelink" href="../../index.html">C++ Async Framework</a></div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <!-- end header part --><!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('d3/da9/md_en_2userver_2tutorial_2build.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Configure and Build</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md460"></a> </p>
<h1><a class="anchor" id="autotoc_md461"></a>
CMake options</h1>
<p>The following options could be used to control <code>cmake</code>:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Option   </th><th class="markdownTableHeadNone">Description   </th><th class="markdownTableHeadNone">Default    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">USERVER_FEATURE_CORE   </td><td class="markdownTableBodyNone">Provide a core library with coroutines, otherwise build only userver-universal   </td><td class="markdownTableBodyNone">ON    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">USERVER_FEATURE_MONGODB   </td><td class="markdownTableBodyNone">Provide asynchronous driver for MongoDB   </td><td class="markdownTableBodyNone">ON if platform is x86* and not *BSD and ${USERVER_FEATURE_CORE}    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">USERVER_FEATURE_POSTGRESQL   </td><td class="markdownTableBodyNone">Provide asynchronous driver for PostgreSQL   </td><td class="markdownTableBodyNone">${USERVER_FEATURE_CORE}    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">USERVER_FEATURE_REDIS   </td><td class="markdownTableBodyNone">Provide asynchronous driver for Redis   </td><td class="markdownTableBodyNone">${USERVER_FEATURE_CORE}    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">USERVER_FEATURE_CLICKHOUSE   </td><td class="markdownTableBodyNone">Provide asynchronous driver for ClickHouse   </td><td class="markdownTableBodyNone">${USERVER_FEATURE_CORE} if platform is x86*; OFF otherwise    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">USERVER_FEATURE_GRPC   </td><td class="markdownTableBodyNone">Provide asynchronous driver for gRPC   </td><td class="markdownTableBodyNone">${USERVER_FEATURE_CORE}    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">USERVER_FEATURE_RABBITMQ   </td><td class="markdownTableBodyNone">Provide asynchronous driver for RabbitMQ (AMQP 0-9-1)   </td><td class="markdownTableBodyNone">${USERVER_FEATURE_CORE}    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">USERVER_FEATURE_MYSQL   </td><td class="markdownTableBodyNone">Provide asynchronous driver for MySQL/MariaDB   </td><td class="markdownTableBodyNone">OFF    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">USERVER_FEATURE_UTEST   </td><td class="markdownTableBodyNone">Provide 'utest' and 'ubench' for unit testing and benchmarking coroutines   </td><td class="markdownTableBodyNone">${USERVER_FEATURE_CORE}    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">USERVER_FEATURE_CRYPTOPP_BLAKE2   </td><td class="markdownTableBodyNone">Provide wrappers for blake2 algorithms of crypto++   </td><td class="markdownTableBodyNone">ON    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">USERVER_FEATURE_PATCH_LIBPQ   </td><td class="markdownTableBodyNone">Apply patches to the libpq (add portals support), requires libpq.a   </td><td class="markdownTableBodyNone">ON    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">USERVER_FEATURE_CRYPTOPP_BASE64_URL   </td><td class="markdownTableBodyNone">Provide wrappers for Base64 URL decoding and encoding algorithms of crypto++   </td><td class="markdownTableBodyNone">ON    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">USERVER_FEATURE_REDIS_HI_MALLOC   </td><td class="markdownTableBodyNone">Provide a <code>hi_malloc(unsigned long)</code> <a href="https://bugs.launchpad.net/ubuntu/+source/hiredis/+bug/1888025">issue</a> workaround   </td><td class="markdownTableBodyNone">OFF    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">USERVER_FEATURE_REDIS_TLS   </td><td class="markdownTableBodyNone">SSL/TLS support for Redis driver   </td><td class="markdownTableBodyNone">OFF    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">USERVER_FEATURE_STACKTRACE   </td><td class="markdownTableBodyNone">Allow capturing stacktraces using boost::stacktrace   </td><td class="markdownTableBodyNone">OFF if platform is not *BSD; ON otherwise    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">USERVER_FEATURE_JEMALLOC   </td><td class="markdownTableBodyNone">Use jemalloc memory allocator   </td><td class="markdownTableBodyNone">ON    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">USERVER_FEATURE_DWCAS   </td><td class="markdownTableBodyNone">Require double-width compare-and-swap   </td><td class="markdownTableBodyNone">ON    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">USERVER_FEATURE_TESTSUITE   </td><td class="markdownTableBodyNone">Enable functional tests via testsuite   </td><td class="markdownTableBodyNone">ON    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">USERVER_FEATURE_GRPC_CHANNELZ   </td><td class="markdownTableBodyNone">Enable Channelz for gRPC   </td><td class="markdownTableBodyNone">ON for "sufficiently new" gRPC versions    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">USERVER_CHECK_PACKAGE_VERSIONS   </td><td class="markdownTableBodyNone">Check package versions   </td><td class="markdownTableBodyNone">ON    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">USERVER_SANITIZE   </td><td class="markdownTableBodyNone">Build with sanitizers support, allows combination of values via 'val1 val2'   </td><td class="markdownTableBodyNone">''    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">USERVER_SANITIZE_BLACKLIST   </td><td class="markdownTableBodyNone">Path to file that is passed to the -fsanitize-blacklist option   </td><td class="markdownTableBodyNone">''    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">USERVER_USE_LD   </td><td class="markdownTableBodyNone">Linker to use, e.g. 'gold' or 'lld'   </td><td class="markdownTableBodyNone">''    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">USERVER_LTO   </td><td class="markdownTableBodyNone">Use link time optimizations   </td><td class="markdownTableBodyNone">OFF for Debug build, ON for all the other builds    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">USERVER_NO_WERROR   </td><td class="markdownTableBodyNone">Do not treat warnings as errors   </td><td class="markdownTableBodyNone">ON    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">USERVER_PYTHON_PATH   </td><td class="markdownTableBodyNone">Path to the python3 binary for use in testsuite tests   </td><td class="markdownTableBodyNone">python3    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">USERVER_DOWNLOAD_PACKAGES   </td><td class="markdownTableBodyNone">Download missing third party packages and use the downloaded versions   </td><td class="markdownTableBodyNone">ON    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">USERVER_DOWNLOAD_PACKAGE_CARES   </td><td class="markdownTableBodyNone">Download and setup c-ares if no c-ares of matching version was found   </td><td class="markdownTableBodyNone">${USERVER_DOWNLOAD_PACKAGES}    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">USERVER_DOWNLOAD_PACKAGE_CCTZ   </td><td class="markdownTableBodyNone">Download and setup cctz if no cctz of matching version was found   </td><td class="markdownTableBodyNone">${USERVER_DOWNLOAD_PACKAGES}    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">USERVER_DOWNLOAD_PACKAGE_CLICKHOUSECPP   </td><td class="markdownTableBodyNone">Download and setup clickhouse-cpp   </td><td class="markdownTableBodyNone">${USERVER_DOWNLOAD_PACKAGES}    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">USERVER_DOWNLOAD_PACKAGE_CRYPTOPP   </td><td class="markdownTableBodyNone">Download and setup CryptoPP if no CryptoPP of matching version was found   </td><td class="markdownTableBodyNone">${USERVER_DOWNLOAD_PACKAGES}    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">USERVER_DOWNLOAD_PACKAGE_CURL   </td><td class="markdownTableBodyNone">Download and setup libcurl if no libcurl of matching version was found   </td><td class="markdownTableBodyNone">${USERVER_DOWNLOAD_PACKAGES}    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">USERVER_DOWNLOAD_PACKAGE_FMT   </td><td class="markdownTableBodyNone">Download and setup Fmt if no Fmt of matching version was found   </td><td class="markdownTableBodyNone">${USERVER_DOWNLOAD_PACKAGES}    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">USERVER_DOWNLOAD_PACKAGE_GTEST   </td><td class="markdownTableBodyNone">Download and setup gtest if no gtest of matching version was found   </td><td class="markdownTableBodyNone">${USERVER_DOWNLOAD_PACKAGES}    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">USERVER_DOWNLOAD_PACKAGE_GBENCH   </td><td class="markdownTableBodyNone">Download and setup gbench if no gbench of matching version was found   </td><td class="markdownTableBodyNone">${USERVER_DOWNLOAD_PACKAGES}    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">USERVER_FORCE_DOWNLOAD_PACKAGES   </td><td class="markdownTableBodyNone">Download all possible third-party packages even if there is an installed system package   </td><td class="markdownTableBodyNone">OFF    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">USERVER_IS_THE_ROOT_PROJECT   </td><td class="markdownTableBodyNone">Build tests, samples and helper tools   </td><td class="markdownTableBodyNone">auto-detects if userver is the top level project    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">USERVER_GOOGLE_COMMON_PROTOS_TARGET   </td><td class="markdownTableBodyNone">Name of cmake target preparing google common proto library   </td><td class="markdownTableBodyNone">Builds userver-api-common-protos    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">USERVER_GOOGLE_COMMON_PROTOS   </td><td class="markdownTableBodyNone">Path to the folder with google common proto files   </td><td class="markdownTableBodyNone">Downloads automatically    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">USERVER_PG_SERVER_INCLUDE_DIR   </td><td class="markdownTableBodyNone">Path to the folder with <a class="el" href="../../d3/da9/md_en_2userver_2tutorial_2build.html#POSTGRES_LIBS">PostgreSQL server headers</a>, for example /usr/include/postgresql/15/server   </td><td class="markdownTableBodyNone">autodetected    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">USERVER_PG_SERVER_LIBRARY_DIR   </td><td class="markdownTableBodyNone">Path to the folder with <a class="el" href="../../d3/da9/md_en_2userver_2tutorial_2build.html#POSTGRES_LIBS">PostgreSQL server libraries</a>, for example /usr/lib/postgresql/15/lib   </td><td class="markdownTableBodyNone">autodetected    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">USERVER_PG_INCLUDE_DIR   </td><td class="markdownTableBodyNone">Path to the folder with <a class="el" href="../../d3/da9/md_en_2userver_2tutorial_2build.html#POSTGRES_LIBS">PostgreSQL libpq headers</a>, for example /usr/local/include   </td><td class="markdownTableBodyNone">autodetected    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">USERVER_PG_LIBRARY_DIR   </td><td class="markdownTableBodyNone">Path to the folder with <a class="el" href="../../d3/da9/md_en_2userver_2tutorial_2build.html#POSTGRES_LIBS">PostgreSQL libpq libraries</a>, for example /usr/local/lib   </td><td class="markdownTableBodyNone">autodetected    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">USERVER_MYSQL_ALLOW_BUGGY_LIBMARIADB   </td><td class="markdownTableBodyNone">Allows mysql driver to leak memory instead of aborting in some rare cases when linked against libmariadb3&lt;3.3.4   </td><td class="markdownTableBodyNone">OFF    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">USERVER_DISABLE_PHDR_CACHE   </td><td class="markdownTableBodyNone">Disable caching of dl_phdr_info items, which interferes with dlopen   </td><td class="markdownTableBodyNone">OFF    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">USERVER_FEATURE_UBOOST_CORO   </td><td class="markdownTableBodyNone">Build with vendored version of Boost.context and Boost.coroutine2, is needed for sanitizers builds   </td><td class="markdownTableBodyNone">ON   </td></tr>
</table>
<p>To explicitly specialize the compiler use the cmake options <code>CMAKE_C_COMPILER</code> and <code>CMAKE_CXX_COMPILER</code>. For example to use clang-12 compiler install it and add the following options to cmake: <code>-DCMAKE_CXX_COMPILER=clang++-12 -DCMAKE_C_COMPILER=clang-12</code></p>
<h2><a class="anchor" id="autotoc_md462"></a>
Downloading packages using CPM</h2>
<p>userver uses <a href="https://github.com/cpm-cmake/CPM.cmake">CPM</a> for downloading missing packages.</p>
<p>By default, we first try to find the corresponding system package. With <code>USERVER_FORCE_DOWNLOAD_PACKAGES=ON</code>, no such attempt is made, and we skip straight to <code>CPMAddPackage</code>. This can be useful to guarantee that the build uses the latest (known to userver) versions of third-party packages.</p>
<p>You can control the usage of CPM with <code>USERVER_DOWNLOAD_*</code> options. For example, <code>USERVER_DOWNLOAD_PACKAGES=OFF</code> is useful for CI and other controlled environments to make sure that no download attempts are made, which ensures repeatability and the best CI build speed.</p>
<p>For details on the download options, refer to <a href="https://github.com/cpm-cmake/CPM.cmake">CPM</a> documentation. Some advice:</p>
<ul>
<li><code>CPM_SOURCE_CACHE</code> helps to avoid re-downloads with multiple userver build modes or multiple CPM-using projects;</li>
<li><code>CPM_USE_NAMED_CACHE_DIRECTORIES</code> (which userver enables by default) avoids junk library names shown in IDEs.</li>
</ul>
<h1><a class="anchor" id="autotoc_md463"></a>
Installation instructions</h1>
<p>Download and extract the latest release from <a href="https://github.com/userver-framework/userver">https://github.com/userver-framework/userver</a></p>
<p>Follow the platforms specific instructions:</p>
<h2><a class="anchor" id="autotoc_md464"></a>
Ubuntu 22.04 (Jammy Jellyfish)</h2>
<ol type="1">
<li>Install the build and test dependencies from ubuntu-22.04.md file, configure git: <div class="fragment"><div class="line">bash</div>
<div class="line">sudo apt install $(cat scripts/docs/en/deps/ubuntu-22.04.md | tr &#39;\n&#39; &#39; &#39;)</div>
<div class="line">git config --global --add safe.directory $(pwd)/third_party/clickhouse-cpp</div>
</div><!-- fragment --></li>
<li>Build the userver: <div class="fragment"><div class="line">bash</div>
<div class="line">mkdir build_release</div>
<div class="line">cd build_release</div>
<div class="line">cmake -DCMAKE_BUILD_TYPE=Release ..</div>
<div class="line">make -j$(nproc)</div>
</div><!-- fragment --></li>
</ol>
<h2><a class="anchor" id="autotoc_md465"></a>
Ubuntu 21.10 (Impish Indri)</h2>
<ol type="1">
<li>Install the build and test dependencies from ubuntu-21.10.md file: <div class="fragment"><div class="line">bash</div>
<div class="line">sudo apt install $(cat scripts/docs/en/deps/ubuntu-21.10.md | tr &#39;\n&#39; &#39; &#39;)</div>
</div><!-- fragment --></li>
<li>Build the userver: <div class="fragment"><div class="line">bash</div>
<div class="line">mkdir build_release</div>
<div class="line">cd build_release</div>
<div class="line">cmake -DCMAKE_BUILD_TYPE=Release ..</div>
<div class="line">make -j$(nproc)</div>
</div><!-- fragment --></li>
</ol>
<h2><a class="anchor" id="autotoc_md466"></a>
Ubuntu 20.04 (Focal Fossa)</h2>
<ol type="1">
<li>Install the build and test dependencies from ubuntu-20.04.md file: <div class="fragment"><div class="line">bash</div>
<div class="line">sudo apt install --allow-downgrades -y $(cat scripts/docs/en/deps/ubuntu-20.04.md | tr &#39;\n&#39; &#39; &#39;)</div>
</div><!-- fragment --></li>
<li>Build the userver: <div class="fragment"><div class="line">bash</div>
<div class="line">mkdir build_release</div>
<div class="line">cd build_release</div>
<div class="line">cmake -DUSERVER_FEATURE_CRYPTOPP_BLAKE2=0 -DUSERVER_FEATURE_REDIS_HI_MALLOC=1 -DCMAKE_BUILD_TYPE=Release ..</div>
<div class="line">make -j$(nproc)</div>
</div><!-- fragment --></li>
</ol>
<h2><a class="anchor" id="autotoc_md467"></a>
Ubuntu 18.04 (Bionic Beaver)</h2>
<ol type="1">
<li>Install the build and test dependencies from ubuntu-18.04.md file: <div class="fragment"><div class="line">bash</div>
<div class="line">sudo apt install --allow-downgrades -y $(cat scripts/docs/en/deps/ubuntu-18.04.md | tr &#39;\n&#39; &#39; &#39;)</div>
</div><!-- fragment --></li>
<li>Build the userver: <div class="fragment"><div class="line">bash</div>
<div class="line">mkdir build_release</div>
<div class="line">cd build_release</div>
<div class="line">cmake -DCMAKE_CXX_COMPILER=g++-8 -DCMAKE_C_COMPILER=gcc-8 -DUSERVER_FEATURE_CRYPTOPP_BLAKE2=0 \</div>
<div class="line">      -DUSERVER_FEATURE_CRYPTOPP_BASE64_URL=0 -DUSERVER_FEATURE_GRPC=0 -DUSERVER_FEATURE_POSTGRESQL=0 \</div>
<div class="line">      -DUSERVER_FEATURE_MONGODB=0 -DUSERVER_USE_LD=gold -DCMAKE_BUILD_TYPE=Release ..</div>
<div class="line">make -j$(nproc)</div>
</div><!-- fragment --></li>
</ol>
<h2><a class="anchor" id="autotoc_md468"></a>
Fedora 35</h2>
<ol type="1">
<li>Install the build and test dependencies from fedora-35.md file: <div class="fragment"><div class="line">bash</div>
<div class="line">sudo dnf install -y $(cat scripts/docs/en/deps/fedora-35.md | tr &#39;\n&#39; &#39; &#39;)</div>
</div><!-- fragment --></li>
<li>Build the userver: <div class="fragment"><div class="line">bash</div>
<div class="line">mkdir build_release</div>
<div class="line">cd build_release</div>
<div class="line">cmake -DUSERVER_FEATURE_STACKTRACE=0 -DUSERVER_FEATURE_PATCH_LIBPQ=0 -DCMAKE_BUILD_TYPE=Release ..</div>
<div class="line">make -j$(nproc)</div>
</div><!-- fragment --></li>
</ol>
<h2><a class="anchor" id="autotoc_md469"></a>
Fedora 36</h2>
<ol type="1">
<li>Install the build and test dependencies from fedora-36.md file: <div class="fragment"><div class="line">bash</div>
<div class="line">sudo dnf install -y $(cat scripts/docs/en/deps/fedora-36.md | tr &#39;\n&#39; &#39; &#39;)</div>
</div><!-- fragment --></li>
<li>Build the userver: <div class="fragment"><div class="line">bash</div>
<div class="line">mkdir build_release</div>
<div class="line">cd build_release</div>
<div class="line">cmake -DUSERVER_FEATURE_STACKTRACE=0 -DUSERVER_FEATURE_PATCH_LIBPQ=0 -DCMAKE_BUILD_TYPE=Release ..</div>
<div class="line">make -j$(nproc)</div>
</div><!-- fragment --></li>
</ol>
<h2><a class="anchor" id="autotoc_md470"></a>
Debian 11 32-bit</h2>
<ol type="1">
<li>Install the build and test dependencies from debian-11x32.md file: <div class="fragment"><div class="line">bash</div>
<div class="line">sudo apt install -y $(cat scripts/docs/en/deps/debian-11x32.md | tr &#39;\n&#39; &#39; &#39;)</div>
</div><!-- fragment --></li>
<li>Build the userver: <div class="fragment"><div class="line">bash</div>
<div class="line">mkdir build_release</div>
<div class="line">cd build_release</div>
<div class="line">cmake -DCMAKE_C_FLAGS=&#39;-D_FILE_OFFSET_BITS=64&#39; -DCMAKE_CXX_FLAGS=&#39;-D_FILE_OFFSET_BITS=64&#39; \</div>
<div class="line">      -DCMAKE_BUILD_TYPE=Release ..</div>
<div class="line">make -j$(nproc)</div>
</div><!-- fragment --></li>
</ol>
<h2><a class="anchor" id="autotoc_md471"></a>
Gentoo</h2>
<ol type="1">
<li>Install the build and test dependencies from gentoo.md file: <div class="fragment"><div class="line">bash</div>
<div class="line">sudo emerge --ask --update --oneshot $(cat scripts/docs/en/deps/gentoo.md | tr &#39;\n&#39; &#39; &#39;)</div>
</div><!-- fragment --></li>
<li>Build the userver: <div class="fragment"><div class="line">bash</div>
<div class="line">mkdir build_release</div>
<div class="line">cd build_release</div>
<div class="line">cmake -DUSERVER_CHECK_PACKAGE_VERSIONS=0 -DUSERVER_FEATURE_GRPC=0 \</div>
<div class="line">      -DUSERVER_FEATURE_CLICKHOUSE=0 -DCMAKE_BUILD_TYPE=Release ..</div>
<div class="line">make -j$(nproc)</div>
</div><!-- fragment --> If you have multiple python version installed and get ModuleNotFoundError use -DPython3_EXECUTABLE="/path/to/python" (e.g. /usr/bin/python3.10) to choose working python version.</li>
</ol>
<h2><a class="anchor" id="autotoc_md472"></a>
Arch</h2>
<ol type="1">
<li>Install the build and test dependencies from arch.md file:<ul>
<li>Using an AUR helper (pikaur in this example) <div class="fragment"><div class="line">bash</div>
<div class="line">pikaur -S $(cat scripts/docs/en/deps/arch.md | sed &#39;s/^makepkg|//g&#39; | tr &#39;\n&#39; &#39; &#39;)</div>
</div><!-- fragment --></li>
<li>No AUR helper <div class="fragment"><div class="line">bash</div>
<div class="line">sudo pacman -S $(cat scripts/docs/en/deps/arch.md | grep -v -- &#39;makepkg|&#39; | tr &#39;\n&#39; &#39; &#39;)</div>
<div class="line">cat scripts/docs/en/deps/arch.md | grep -oP &#39;^makepkg\|\K.*&#39; | while read ;\</div>
<div class="line">  do \</div>
<div class="line">    DIR=$(mktemp -d) ;\</div>
<div class="line">    git clone https://aur.archlinux.org/$REPLY.git $DIR ;\</div>
<div class="line">    pushd $DIR ;\</div>
<div class="line">    yes|makepkg -si ;\</div>
<div class="line">    popd ;\</div>
<div class="line">    rm -rf $DIR ;\</div>
<div class="line">  done</div>
</div><!-- fragment --></li>
</ul>
</li>
<li>Build the userver: <div class="fragment"><div class="line">bash</div>
<div class="line">mkdir build_release</div>
<div class="line">cd build_release</div>
<div class="line">cmake -DUSERVER_FEATURE_PATCH_LIBPQ=0 -DCMAKE_BUILD_TYPE=Release ..</div>
<div class="line">make -j$(nproc)</div>
</div><!-- fragment --></li>
</ol>
<h2><a class="anchor" id="autotoc_md473"></a>
MacOS</h2>
<p>MacOS is recommended only for development as it may have performance issues in some cases. At least MacOS 10.15 required with <a href="https://apps.apple.com/us/app/xcode/id497799835">Xcode</a> and <a href="https://brew.sh/">Homebrew</a>.</p>
<ol type="1">
<li>Install the build and test dependencies from macos.md file: <div class="fragment"><div class="line">brew install $(cat scripts/docs/en/deps/macos.md | tr &#39;\n&#39; &#39; &#39;)</div>
</div><!-- fragment --></li>
<li>Force link OpenSSL 1.1: <div class="fragment"><div class="line">brew link --force openssl@1.1</div>
</div><!-- fragment --></li>
<li><p class="startli">Build the userver: </p><div class="fragment"><div class="line">mkdir build_release</div>
<div class="line">cd build_release</div>
<div class="line">cmake -DCMAKE_BUILD_TYPE=Release -DCMAKE_EXPORT_COMPILE_COMMANDS=ON \</div>
<div class="line">    -DUSERVER_NO_WERROR=1 -DUSERVER_CHECK_PACKAGE_VERSIONS=0 \</div>
<div class="line">    -DUSERVER_FEATURE_REDIS_HI_MALLOC=1 \</div>
<div class="line">    -DUSERVER_FEATURE_CRYPTOPP_BLAKE2=0 -DUSERVER_DOWNLOAD_PACKAGE_CRYPTOPP=1 \</div>
<div class="line">    -DUSERVER_FEATURE_CLICKHOUSE=0 \</div>
<div class="line">    -DUSERVER_FEATURE_RABBITMQ=0 \</div>
<div class="line">    -DOPENSSL_ROOT_DIR=$(brew --prefix openssl@1.1) \</div>
<div class="line">    -DUSERVER_PG_LIBRARY_DIR=$(pg_config --libdir) -DUSERVER_PG_INCLUDE_DIR=$(pg_config --includedir) \</div>
<div class="line">    -DUSERVER_PG_SERVER_LIBRARY_DIR=$(pg_config --pkglibdir) -DUSERVER_PG_SERVER_INCLUDE_DIR=$(pg_config --includedir-server) \</div>
<div class="line">    ..</div>
</div><!-- fragment --><p class="startli">Follow the cmake hints for the installation of required packets and keep calling cmake with the options.</p>
<p class="startli">To run the tests, increase the limits of open files count via: </p><div class="fragment"><div class="line">ulimit -n 4096</div>
</div><!-- fragment --></li>
</ol>
<h2><a class="anchor" id="autotoc_md474"></a>
Other POSIX based platforms</h2>
<p>🐙 <b>userver</b> works well on modern POSIX platforms. Follow the cmake hints for the installation of required packets and experiment with the CMake options.</p>
<p>Feel free to provide a PR with instructions for your favorite platform at <a href="https://github.com/userver-framework/userver">https://github.com/userver-framework/userver</a>.</p>
<p><a class="anchor" id="POSTGRES_LIBS"></a></p>
<h2><a class="anchor" id="autotoc_md475"></a>
PostgreSQL versions</h2>
<p>If CMake option <code>USERVER_FEATURE_PATCH_LIBPQ</code> is on, then the same developer version of libpq, libpgport and libpgcommon libraries should be available on the system. If there are multiple versions of those libraries use USERVER_PG_* CMake options to aid the build system in finding the right version.</p>
<p>You could also install any version of the above libraries by explicitly pinning the version. For example in Debian/Ubuntu pinning to version 14 could be done via the following commands: </p><div class="fragment"><div class="line">sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv 7FCC7D46ACCC4CF8</div>
<div class="line">echo &quot;deb https://apt-archive.postgresql.org/pub/repos/apt jammy-pgdg-archive main&quot; | sudo tee /etc/apt/sources.list.d/pgdg.list</div>
<div class="line">sudo apt update</div>
<div class="line"> </div>
<div class="line">sudo mkdir -p /etc/apt/preferences.d</div>
<div class="line"> </div>
<div class="line">printf &quot;Package: postgresql-14\nPin: version 14.5*\nPin-Priority: 1001\n&quot; | sudo tee -a /etc/apt/preferences.d/postgresql-14</div>
<div class="line">printf &quot;Package: postgresql-client-14\nPin: version 14.5*\nPin-Priority: 1001\n&quot; | sudo tee -a /etc/apt/preferences.d/postgresql-client-14</div>
<div class="line">sudo apt install --allow-downgrades -y postgresql-14 postgresql-client-14</div>
<div class="line"> </div>
<div class="line">printf &quot;Package: libpq5\nPin: version 14.5*\nPin-Priority: 1001\n&quot; | sudo tee -a /etc/apt/preferences.d/libpq5</div>
<div class="line">printf &quot;Package: libpq-dev\nPin: version 14.5*\nPin-Priority: 1001\n&quot;| sudo tee -a /etc/apt/preferences.d/libpq-dev</div>
<div class="line">sudo apt install --allow-downgrades -y libpq5 libpq-dev</div>
</div><!-- fragment --><p><a class="anchor" id="DOCKER_BUILD"></a></p>
<h2><a class="anchor" id="autotoc_md476"></a>
Docker</h2>
<dl class="section note"><dt>Note</dt><dd>Currently, only x86_64 and x86 architectures support ClickHouse and MongoDB drivers as the native libraries for those databases do not support other architectures. Those drivers are disabled on other architectures via CMake options.</dd></dl>
<p>Docker images in userver provide the following functionality:</p><ul>
<li>build and start all userver tests: <div class="fragment"><div class="line">bash</div>
<div class="line">docker-compose run --rm userver-tests</div>
</div><!-- fragment --></li>
<li>build <code>hello_service</code> sample: <div class="fragment"><div class="line">bash</div>
<div class="line">docker-compose run --rm userver-service-sample</div>
</div><!-- fragment --> or <div class="fragment"><div class="line">bash</div>
<div class="line">SERVICE_NAME=hello_service docker-compose run --rm userver-service-sample</div>
</div><!-- fragment --></li>
<li>execute commands in userver development environment: <div class="fragment"><div class="line">bash</div>
<div class="line">docker-compose run --rm userver-ubuntu bash</div>
</div><!-- fragment --></li>
</ul>
<p>Each step of the <code>userver-tests</code> could be executed separately:</p>
<p>Start CMake: </p><div class="fragment"><div class="line">docker-compose run --rm userver-ubuntu bash -c &#39;cmake $CMAKE_OPTS -B./build -S./&#39;</div>
</div><!-- fragment --><p> Build userver: </p><div class="fragment"><div class="line">docker-compose run --rm userver-ubuntu bash -c &#39;cd /userver/build &amp;&amp; make -j $(nproc)&#39;</div>
</div><!-- fragment --><p> Run all test: </p><div class="fragment"><div class="line">docker-compose run --rm userver-ubuntu bash -c &#39;cd /userver/build &amp;&amp; ulimit -n 4096 &amp;&amp; ctest -V&#39;</div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md477"></a>
Using make, you can build the service easier</h4>
<p>Start cmake: </p><div class="fragment"><div class="line">make docker-cmake-debug</div>
</div><!-- fragment --><p> Build userver: </p><div class="fragment"><div class="line">make docker-build-debug</div>
</div><!-- fragment --><p> Run tests: </p><div class="fragment"><div class="line">make docker-test-debug</div>
</div><!-- fragment --><p> You can replace the debug with a release</p>
<h2><a class="anchor" id="autotoc_md478"></a>
Run framework tests</h2>
<p>To run tests and make sure that the framework works fine use the following command: </p><div class="fragment"><div class="line">bash</div>
<div class="line">cd build_release &amp;&amp; ulimit -n 4096 &amp;&amp; ctest -V</div>
</div><!-- fragment --><p>If you need to edit or make your own docker image with custom configuration, read about it <a class="el" href="../../d8/df2/md_en_2userver_2docker.html">here</a></p>
<h2><a class="anchor" id="autotoc_md479"></a>
Conan</h2>
<dl class="section note"><dt>Note</dt><dd>conan must have version &gt;= 1.51, but &lt; 2.0</dd></dl>
<p>Thanks to Open-Source community we have Conan support.</p>
<p>You must run the following in the userver directory: </p><div class="fragment"><div class="line">conan profile new --detect default &amp;&amp; conan profile update settings.compiler.libcxx=libstdc++11 default</div>
<div class="line">conan create . --build=missing -pr:b=default -tf conan/test_package/</div>
</div><!-- fragment --><p>Now you can use userver as conan package and build it in your services.</p>
<hr  />
<p> <div class="bottom-nav">  ⇦ <a class="el" href="../../d0/dd5/md_en_2userver_2supported__platforms.html">Supported Platforms</a> | <a class="el" href="../../d2/d58/md_en_2userver_2deploy__env.html">Deploy Environment Specific Configurations</a> ⇨  </div>  </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Wed Oct 4 2023 12:20:25 for userver by
    <a href="https://www.doxygen.org/index.html">Doxygen</a> 1.9.8</li>
  </ul>
</div>
<script type="text/javascript" src="../../codeHighlight.js"></script>
<script type="text/javascript" src="../../telegramLanguage.js"></script>
<script type="text/javascript" src="../../styledBtn.js"></script>
<script type="text/javascript" src="../../search.js"></script>
<script type="text/javascript" src="../../header.js"></script>
<script type="text/javascript" src="../../searchHighlight.js"></script>
<script>
  const addLinks = () =>  {
      const links = document.createElement('div')
      links.id = 'links';
      links.innerHTML = `
          <a href="https://github.com/userver-framework/" rel="noopener" target="_blank" class="titlelink">
              <img src="../../github_logo.svg" alt="Github" class="gh-logo"/> 
          </a>
          <a href="https://t.me/userver_en" rel="noopener" id='telegram_channel' target="_blank" class="titlelink">
              <img src="../../telegram_logo.svg" alt="Telegram"/>
          </a>
      `
      document.getElementById('main-navbar').appendChild(links);
  }
  $(function() {
    $(document).ready(function() {
      setTimeout(() => {
      init_all_results_button();
      init_header();
      addLinks();
      const isLanding = document.getElementById('landing_logo_id') !== null;
      if (isLanding) return;
      highlight_code();
      styleNavButtons(); // TODO: code style?
    }, 0);
    });
  });
</script>
</body>
</html>
